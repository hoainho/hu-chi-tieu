# ğŸ¯ TÃ­nh nÄƒng Quá»¹ Tiáº¿t Kiá»‡m Má»¥c TiÃªu (Savings Goals)

## Tá»•ng quan

TÃ­nh nÄƒng **Quá»¹ Tiáº¿t Kiá»‡m Má»¥c TiÃªu** cho phÃ©p ngÆ°á»i dÃ¹ng táº¡o vÃ  quáº£n lÃ½ cÃ¡c quá»¹ tiáº¿t kiá»‡m cho cÃ¡c má»¥c tiÃªu cá»¥ thá»ƒ trong tÆ°Æ¡ng lai, nhÆ°:
- ğŸ–ï¸ **Quá»¹ du lá»‹ch**: Tiáº¿t kiá»‡m cho chuyáº¿n du lá»‹ch Há»™i An, ÄÃ  Láº¡t, v.v.
- ğŸ†˜ **Quá»¹ kháº©n cáº¥p/tháº¥t nghiá»‡p**: Dá»± phÃ²ng cho cÃ¡c tÃ¬nh huá»‘ng kháº©n cáº¥p
- ğŸ’¼ **Quá»¹ kinh doanh**: Vá»‘n Ä‘á»ƒ khá»Ÿi nghiá»‡p hoáº·c má»Ÿ rá»™ng kinh doanh
- ğŸ“ **Quá»¹ giÃ¡o dá»¥c**: Há»c phÃ­, khÃ³a há»c, Ä‘Ã o táº¡o
- ğŸ  **Quá»¹ mua nhÃ **: Tiáº¿t kiá»‡m Ä‘á»ƒ mua nhÃ , Ä‘áº¥t
- ğŸ’° **Quá»¹ khÃ¡c**: CÃ¡c má»¥c tiÃªu tÃ¹y chá»‰nh khÃ¡c

## Äáº·c Ä‘iá»ƒm chÃ­nh

### 1. Táº¡o Quá»¹ Tiáº¿t Kiá»‡m
- **TÃªn quá»¹**: Äáº·t tÃªn mÃ´ táº£ cho quá»¹ (VD: "Quá»¹ du lá»‹ch Há»™i An 2025")
- **Má»¥c tiÃªu**: Sá»‘ tiá»n cáº§n Ä‘áº¡t Ä‘Æ°á»£c (VD: 10,000,000 VND)
- **ÄÃ³ng gÃ³p hÃ ng thÃ¡ng**: Sá»‘ tiá»n dá»± kiáº¿n náº¡p má»—i thÃ¡ng (tÃ¹y chá»n)
- **Thá»i háº¡n**: NgÃ y dá»± kiáº¿n hoÃ n thÃ nh má»¥c tiÃªu (tÃ¹y chá»n)
- **Loáº¡i quá»¹**: PhÃ¢n loáº¡i theo má»¥c Ä‘Ã­ch sá»­ dá»¥ng

### 2. Náº¡p Tiá»n vÃ o Quá»¹ (Deposit)
- Chá»n nguá»“n tiá»n Ä‘á»ƒ trá»« (tá»« Spending Sources)
- Nháº­p sá»‘ tiá»n muá»‘n náº¡p
- ThÃªm ghi chÃº (tÃ¹y chá»n)
- Há»‡ thá»‘ng tá»± Ä‘á»™ng:
  - âœ… Cá»™ng tiá»n vÃ o quá»¹
  - âœ… Trá»« tiá»n tá»« nguá»“n chi tiÃªu Ä‘Ã£ chá»n
  - âœ… LÆ°u lá»‹ch sá»­ giao dá»‹ch
  - âœ… Cáº­p nháº­t tráº¡ng thÃ¡i "HoÃ n thÃ nh" náº¿u Ä‘áº¡t má»¥c tiÃªu

### 3. RÃºt Tiá»n tá»« Quá»¹ (Withdraw)
- Chá»n nguá»“n tiá»n Ä‘á»ƒ nháº­n (vÃ o Spending Sources)
- Nháº­p sá»‘ tiá»n muá»‘n rÃºt
- ThÃªm ghi chÃº (VD: "Chi tiÃªu cho chuyáº¿n du lá»‹ch Há»™i An")
- Há»‡ thá»‘ng tá»± Ä‘á»™ng:
  - âœ… Trá»« tiá»n tá»« quá»¹
  - âœ… Cá»™ng tiá»n vÃ o nguá»“n chi tiÃªu Ä‘Ã£ chá»n
  - âœ… LÆ°u lá»‹ch sá»­ giao dá»‹ch

### 4. Theo DÃµi Tiáº¿n Äá»™
- **Progress Bar**: Hiá»ƒn thá»‹ % hoÃ n thÃ nh má»¥c tiÃªu
- **Sá»‘ tiá»n hiá»‡n táº¡i**: Tá»•ng tiá»n Ä‘Ã£ tÃ­ch lÅ©y
- **Sá»‘ tiá»n cÃ²n thiáº¿u**: Sá»‘ tiá»n cáº§n náº¡p thÃªm Ä‘á»ƒ Ä‘áº¡t má»¥c tiÃªu
- **Tráº¡ng thÃ¡i**: Active, Completed, Paused

### 5. Quáº£n LÃ½ Quá»¹
- **Xem danh sÃ¡ch**: Táº¥t cáº£ quá»¹ vá»›i thÃ´ng tin tá»•ng quan
- **Chá»‰nh sá»­a**: Cáº­p nháº­t thÃ´ng tin quá»¹ (tÃªn, má»¥c tiÃªu, deadline)
- **XÃ³a quá»¹**: XÃ³a quá»¹ khÃ´ng cÃ²n cáº§n thiáº¿t
- **Lá»‹ch sá»­ giao dá»‹ch**: Xem táº¥t cáº£ giao dá»‹ch náº¡p/rÃºt cá»§a quá»¹

## Luá»“ng hoáº¡t Ä‘á»™ng

### VÃ­ dá»¥: Quá»¹ Du Lá»‹ch Há»™i An

**BÆ°á»›c 1: Táº¡o quá»¹**
```
TÃªn: "Quá»¹ du lá»‹ch Há»™i An 2025"
Má»¥c tiÃªu: 10,000,000 VND
ÄÃ³ng gÃ³p/thÃ¡ng: 1,500,000 VND
Thá»i háº¡n: 31/12/2025
Loáº¡i: Du lá»‹ch
```

**BÆ°á»›c 2: Náº¡p tiá»n Ä‘á»‹nh ká»³**
```
ThÃ¡ng 1: Náº¡p 1,500,000 VND tá»« "TÃ i khoáº£n ngÃ¢n hÃ ng"
â†’ Quá»¹: 0 â†’ 1,500,000 VND
â†’ NgÃ¢n hÃ ng: 20,000,000 â†’ 18,500,000 VND

ThÃ¡ng 2: Náº¡p 1,500,000 VND tá»« "TÃ i khoáº£n ngÃ¢n hÃ ng"
â†’ Quá»¹: 1,500,000 â†’ 3,000,000 VND
â†’ NgÃ¢n hÃ ng: 18,500,000 â†’ 17,000,000 VND

... (tiáº¿p tá»¥c 6 thÃ¡ng)

ThÃ¡ng 7: Náº¡p 1,000,000 VND
â†’ Quá»¹: 9,000,000 â†’ 10,000,000 VND âœ… HoÃ n thÃ nh!
```

**BÆ°á»›c 3: Sá»­ dá»¥ng quá»¹**
```
RÃºt 8,000,000 VND vÃ o "VÃ­ tiá»n máº·t" Ä‘á»ƒ chi tiÃªu du lá»‹ch
â†’ Quá»¹: 10,000,000 â†’ 2,000,000 VND
â†’ VÃ­ tiá»n máº·t: 500,000 â†’ 8,500,000 VND

Ghi chÃº: "Chi tiÃªu cho chuyáº¿n du lá»‹ch Há»™i An 3 ngÃ y 2 Ä‘Ãªm"
```

## Kiáº¿n trÃºc ká»¹ thuáº­t

### Database Schema

**Collection: `savingsGoals`**
```typescript
{
  id: string;
  name: string;
  description?: string;
  targetAmount: number;
  currentAmount: number;
  monthlyContribution?: number;
  category: 'travel' | 'emergency' | 'business' | 'education' | 'house' | 'other';
  deadline?: Timestamp;
  status: 'active' | 'completed' | 'paused';
  ownerType: 'private' | 'shared';
  ownerId: string;
  coupleId?: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

**Collection: `savingsGoalTransactions`**
```typescript
{
  id: string;
  goalId: string;
  type: 'deposit' | 'withdraw';
  amount: number;
  description?: string;
  date: Timestamp;
  ownerId: string;
  spendingSourceId?: string;
}
```

### Redux State Management

**Slice**: `savingsGoalSlice.ts`

**Actions**:
- `fetchSavingsGoals`: Láº¥y danh sÃ¡ch quá»¹
- `createGoal`: Táº¡o quá»¹ má»›i
- `updateGoal`: Cáº­p nháº­t thÃ´ng tin quá»¹
- `deleteGoal`: XÃ³a quá»¹
- `depositToGoal`: Náº¡p tiá»n vÃ o quá»¹
- `withdrawFromGoal`: RÃºt tiá»n tá»« quá»¹
- `fetchGoalTransactions`: Láº¥y lá»‹ch sá»­ giao dá»‹ch

### Firestore Security Rules

```javascript
// Savings goals with couple sharing
match /savingsGoals/{goalId} {
  allow read: if request.auth != null && (
    resource.data.ownerId == request.auth.uid ||
    (resource.data.coupleId != null && hasPartnerAccess(resource.data.coupleId))
  );
  
  allow create: if request.auth != null && 
    request.resource.data.ownerId == request.auth.uid;
  
  allow update: if request.auth != null && 
    resource.data.ownerId == request.auth.uid;
  
  allow delete: if request.auth != null && 
    resource.data.ownerId == request.auth.uid;
}

// Savings goal transactions
match /savingsGoalTransactions/{transactionId} {
  allow read: if request.auth != null && 
    resource.data.ownerId == request.auth.uid;
  
  allow create: if request.auth != null && 
    request.resource.data.ownerId == request.auth.uid;
  
  allow delete: if request.auth != null && 
    resource.data.ownerId == request.auth.uid;
}
```

## Files Created/Modified

### New Files
1. **`types/index.ts`**: Added `SavingsGoal` and `SavingsGoalTransaction` interfaces
2. **`services/firestoreService.ts`**: Added CRUD functions for savings goals
3. **`store/slices/savingsGoalSlice.ts`**: Redux slice for savings goals
4. **`components/savings/SavingsGoalsPage.tsx`**: Main UI component
5. **`docs/SAVINGS_GOALS_FEATURE.md`**: This documentation

### Modified Files
1. **`store/index.ts`**: Added `savingsGoalReducer` to store
2. **`App.tsx`**: Added `/savings-goals` route
3. **`components/layout/Layout.tsx`**: Added "Quá»¹ Tiáº¿t Kiá»‡m" menu item
4. **`firestore.rules`**: Added security rules for savings goals

## TÃ­ch há»£p vá»›i Spending Sources

TÃ­nh nÄƒng nÃ y **tÃ­ch há»£p cháº·t cháº½** vá»›i Spending Sources:

### Khi Náº¡p Tiá»n (Deposit)
1. User chá»n nguá»“n tiá»n (VD: "TÃ i khoáº£n ngÃ¢n hÃ ng")
2. Nháº­p sá»‘ tiá»n muá»‘n náº¡p
3. Há»‡ thá»‘ng:
   - Cá»™ng tiá»n vÃ o `savingsGoal.currentAmount`
   - Trá»« tiá»n tá»« `spendingSource.balance`
   - Táº¡o transaction record

### Khi RÃºt Tiá»n (Withdraw)
1. User chá»n nguá»“n tiá»n nháº­n (VD: "VÃ­ tiá»n máº·t")
2. Nháº­p sá»‘ tiá»n muá»‘n rÃºt
3. Há»‡ thá»‘ng:
   - Trá»« tiá»n tá»« `savingsGoal.currentAmount`
   - Cá»™ng tiá»n vÃ o `spendingSource.balance`
   - Táº¡o transaction record

## Use Cases

### 1. Tiáº¿t kiá»‡m cho Du Lá»‹ch
```
Má»¥c tiÃªu: 15,000,000 VND cho chuyáº¿n du lá»‹ch Nháº­t Báº£n
Thá»i gian: 12 thÃ¡ng
ÄÃ³ng gÃ³p: 1,300,000 VND/thÃ¡ng
```

### 2. Quá»¹ Kháº©n Cáº¥p
```
Má»¥c tiÃªu: 50,000,000 VND (6 thÃ¡ng lÆ°Æ¡ng)
Thá»i gian: 24 thÃ¡ng
ÄÃ³ng gÃ³p: 2,100,000 VND/thÃ¡ng
```

### 3. Vá»‘n Kinh Doanh
```
Má»¥c tiÃªu: 100,000,000 VND Ä‘á»ƒ má»Ÿ quÃ¡n cafe
Thá»i gian: 18 thÃ¡ng
ÄÃ³ng gÃ³p: 5,600,000 VND/thÃ¡ng
```

## Lá»£i Ã­ch

1. âœ… **Má»¥c tiÃªu rÃµ rÃ ng**: Biáº¿t chÃ­nh xÃ¡c cáº§n tiáº¿t kiá»‡m bao nhiÃªu
2. âœ… **Theo dÃµi tiáº¿n Ä‘á»™**: Xem Ä‘Æ°á»£c % hoÃ n thÃ nh theo thá»i gian thá»±c
3. âœ… **Tá»± Ä‘á»™ng hÃ³a**: TÃ­ch há»£p vá»›i spending sources, khÃ´ng cáº§n tÃ­nh toÃ¡n thá»§ cÃ´ng
4. âœ… **Lá»‹ch sá»­ Ä‘áº§y Ä‘á»§**: Xem láº¡i táº¥t cáº£ giao dá»‹ch náº¡p/rÃºt
5. âœ… **PhÃ¢n loáº¡i**: Quáº£n lÃ½ nhiá»u quá»¹ cho nhiá»u má»¥c tiÃªu khÃ¡c nhau
6. âœ… **Äá»™ng lá»±c**: Progress bar vÃ  status giÃºp duy trÃ¬ Ä‘á»™ng lá»±c tiáº¿t kiá»‡m

## Roadmap tÆ°Æ¡ng lai

- [ ] **Tá»± Ä‘á»™ng náº¡p tiá»n**: Thiáº¿t láº­p auto-deposit hÃ ng thÃ¡ng
- [ ] **ThÃ´ng bÃ¡o**: Nháº¯c nhá»Ÿ khi Ä‘áº¿n háº¡n Ä‘Ã³ng gÃ³p
- [ ] **Biá»ƒu Ä‘á»“**: Visualize tiáº¿n Ä‘á»™ theo thá»i gian
- [ ] **Chia sáº» quá»¹**: Quá»¹ chung cho couple (shared goals)
- [ ] **LÃ£i suáº¥t**: TÃ­nh lÃ£i suáº¥t cho quá»¹ tiáº¿t kiá»‡m dÃ i háº¡n
- [ ] **Templates**: Máº«u quá»¹ cÃ³ sáºµn cho cÃ¡c má»¥c tiÃªu phá»• biáº¿n

## Deploy

Nhá»› deploy Firestore rules sau khi implement:

```bash
./deploy-rules.sh
# hoáº·c
firebase deploy --only firestore:rules
```
